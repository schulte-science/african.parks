# { .[rowSums(.) > 0, colSums(.) > 0] }
}
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park,
DNA_Common_Host %in% input$filter_species)
input$filter_park
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park)
set.seed(123)
tmp_nmds <- vegan::metaMDS(tmp_wide, trymax = 1)
View(tmp_wide)
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park) |>
tidyr::pivot_wider(names_from = ESVId, id_cols = Barcode, values_from = Reads)
View(tmp_wide)
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park) |>
tidyr::pivot_wider(names_from = ESVId, id_cols = Barcode, values_from = Reads) |>
tibble::column_to_rownames(var = "Barcode") |>
dplyr::mutate(dplyr::across(dplyr::everything(), ~tidyr::replace_na(., 0)))
View(tmp_wide)
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park) |>
tidyr::pivot_wider(names_from = ESVId, id_cols = Barcode, values_from = Reads) |>
tibble::column_to_rownames(var = "Barcode") |>
dplyr::mutate(dplyr::across(dplyr::everything(), ~tidyr::replace_na(., 0))) |>
{ .[rowSums(.) > 0, colSums(.) > 0] }
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park) |>
tidyr::pivot_wider(names_from = ESVId, id_cols = Barcode, values_from = Reads) |>
tibble::column_to_rownames(var = "Barcode") |>
dplyr::mutate(dplyr::across(dplyr::everything(), ~tidyr::replace_na(., 0))) |>
(\(x) x[rowSums(x) > 0, colSums(x) > 0])()
tmp_wide <- rv$trnl |>
dplyr::filter(name_of_park %in% input$filter_park) |>
tidyr::pivot_wider(names_from = ESVId, id_cols = Barcode, values_from = Reads) |>
tibble::column_to_rownames(var = "Barcode") |>
dplyr::mutate(dplyr::across(dplyr::everything(), ~tidyr::replace_na(., 0))) |>
(\(x) x[rowSums(x) > 0, colSums(x) > 0])()
View(tmp_wide)
set.seed(123)
tmp_nmds <- vegan::metaMDS(tmp_wide, trymax = 1)
tmp_df <- scores(tmp_nmds)$sites %>%
as.data.frame() %>%
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
tmp_df <- scores(tmp_nmds)$sites |>
as.data.frame() |>
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
tmp_df <- vegan::scores(tmp_nmds)$sites |>
as.data.frame() |>
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
iqr <- IQR(x, na.rm = TRUE)
flag_outliers <- function(x) {
qnt <- quantile(x, probs = c(0.25, 0.75), na.rm = TRUE)
iqr <- IQR(x, na.rm = TRUE)
outlier_low <- x < (qnt[1] - 1.5 * iqr)
outlier_high <- x > (qnt[2] + 1.5 * iqr)
outlier_low | outlier_high
}
tmp_df <- vegan::scores(tmp_nmds)$sites |>
as.data.frame() |>
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
ggplot2::ggplot(tmp_df, aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_df, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
golem:::run_dev()
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId")
View(tmp_spp)
View(rv$trnl)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")]) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) %>%
dplyr::slice_max(order_by = dist, n = 4)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")]) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 4)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")]) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 4)
View(tmp_spp)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 4)
View(tmp_spp)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 1, with_ties = FALSE)
View(tmp_spp)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant)
View(tmp_spp)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 1, with_ties = FALSE)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
dplyr::geom_text(data = tmp_spp, aes(label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
tmp_sites <- vegan::scores(tmp_nmds)$sites |>
as.data.frame() |>
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 1, with_ties = FALSE)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
dplyr::geom_text(data = tmp_spp, aes(label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::geom_text(data = tmp_spp, aes(label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::geom_text(data = tmp_spp, dplyr::aes(label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::geom_text(data = tmp_spp, ggplot2::aes(label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::geom_text(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
xrange <- range(tmp_sites$NMDS1, na.rm = TRUE)
yrange <- range(tmp_sites$NMDS2, na.rm = TRUE)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::filter(dplyr::between(NMDS1, xrange[1], xrange[2]),
dplyr::between(NMDS2, yrange[1], yrange[2])) |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 1, with_ties = FALSE)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggplot2::geom_text(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, fontface = "bold", inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
golem:::run_dev()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, inherit.aes = FALSE) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, point.color = "black", segment.color = "black") +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, point.color = "black", segment.color = "black") +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, segment.color = "black") +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
tmp_sites <- vegan::scores(tmp_nmds)$sites |>
as.data.frame() |>
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
xrange <- range(tmp_sites$NMDS1, na.rm = TRUE)
yrange <- range(tmp_sites$NMDS2, na.rm = TRUE)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::filter(dplyr::between(NMDS1, xrange[1], xrange[2]),
dplyr::between(NMDS2, yrange[1], yrange[2])) |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 1, with_ties = FALSE)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
golem:::run_dev()
tmp_sites <- vegan::scores(tmp_nmds)$sites |>
as.data.frame() |>
tibble::rownames_to_column(var = "Barcode") |>
dplyr::mutate(outlier_NMDS1 = flag_outliers(NMDS1),
outlier_NMDS2 = flag_outliers(NMDS2)) |>
dplyr::filter(!(outlier_NMDS1 | outlier_NMDS2)) |>
dplyr::left_join(rv$meta[,c("barcode_id", "species_id_dna_common")], by = c("Barcode" = "barcode_id"))
View(tmp_sites)
xrange <- range(tmp_sites$NMDS1, na.rm = TRUE)
yrange <- range(tmp_sites$NMDS2, na.rm = TRUE)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::filter(dplyr::between(NMDS1, xrange[1], xrange[2]),
dplyr::between(NMDS2, yrange[1], yrange[2])) |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 1, with_ties = FALSE)
View(tmp_spp)
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::filter(dplyr::between(NMDS1, xrange[1], xrange[2]),
dplyr::between(NMDS2, yrange[1], yrange[2])) |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
)
View(tmp_spp)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, inherit.aes = F) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
tmp_spp <- vegan::scores(tmp_nmds, "species") |>
as.data.frame() |>
tibble::rownames_to_column(var = "ESVId") |>
dplyr::filter(dplyr::between(NMDS1, xrange[1], xrange[2]),
dplyr::between(NMDS2, yrange[1], yrange[2])) |>
dplyr::left_join(rv$trnl[,c("ESVId", "Class", "Order", "Family", "Genus", "Species")] |> dplyr::distinct(ESVId, .keep_all = T)) |>
dplyr::mutate(Consensus = paste(Class, Order, Family, Genus, Species, sep = ";"), # Get consensus taxonomy (lowest non-NA rank name)
Consensus = gsub("\\;NA.*|\\;\\;.*", "", Consensus),
Consensus = stringr::str_remove(Consensus, ";$"),
Consensus = sub(".*;(.*)$", "\\1", Consensus),
Consensus = ifelse(Consensus %in% c("NA", ""), NA, Consensus)) |>
dplyr::mutate(
quadrant = dplyr::case_when(
NMDS1 >= 0 & NMDS2 >= 0 ~ "Q1",
NMDS1 <  0 & NMDS2 >= 0 ~ "Q2",
NMDS1 <  0 & NMDS2 <  0 ~ "Q3",
NMDS1 >= 0 & NMDS2 <  0 ~ "Q4"
),
dist = sqrt(NMDS1^2 + NMDS2^2)
) |>
dplyr::group_by(quadrant) |>
dplyr::slice_max(order_by = dist, n = 5, with_ties = FALSE)
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), color = "black", size = 3, inherit.aes = F) +
ggplot2::labs(fill = "Host (from DNA)") +
ggplot2::theme_bw()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), ggrepel::color = "black", size = 3, inherit.aes = F) +
golem:::run_dev()
ggplot2::ggplot(tmp_sites, ggplot2::aes(x = NMDS1, y = NMDS2, fill = species_id_dna_common)) +
ggplot2::geom_point(color = "black", size = 3, shape = 21, alpha = 0.7) +
ggrepel::geom_text_repel(data = tmp_spp, ggplot2::aes(x = NMDS1, y = NMDS2, label = Consensus), ggrepel::color = "black", size = 3, inherit.aes = F) +
golem:::run_dev()
golem:::run_dev()
golem:::run_dev()
View(rv$trnl |>
dplyr::filter(name_of_park %in% "iona") |>
dplyr::add_count(DNA_Common_Host))
View(rv$trnl |>
dplyr::filter(name_of_park %in% "iona") |>
dplyr::group_by(DNA_Common_Host) |>
dplyr::distinct(Barcode, .keep_all = T)
)
View(rv$trnl |>
dplyr::filter(name_of_park %in% "iona") |>
dplyr::distinct(Barcode, DNA_Common_Host) |>
dplyr::add_count(DNA_Common_Host) |>
dplyr::filter(n > 1) |>
dplyr::distinct(DNA_Common_Host) |>
dplyr::arrange(DNA_Common_Host) |>
dplyr::pull(DNA_Common_Host))
golem:::run_dev()
golem:::run_dev()
golem:::run_dev()
golem:::run_dev()
golem:::run_dev()
View(rv$trnl |>
dplyr::filter(name_of_park %in% "iona") |>
dplyr::distinct(Barcode, DNA_Common_Host) |>
dplyr::add_count(DNA_Common_Host) )
golem:::run_dev()
golem:::run_dev()
golem:::run_dev()
``
golem:::run_dev()
